# Как создать свой плагин

Чтобы создать файл плагина для startupjs, вы должны следовать определенным соглашениям именования и размещения файлов. Вот шаги, которые помогут вам это сделать:

1) Выберите название для файла плагина. Название должно быть уникальным и отражать его функциональность. Например, customInputType.plugin.js. Важно, чтобы название файла содержало суффикс .plugin.js, чтобы система startupjs могла корректно его идентифицировать как плагин.

2) Создайте файл плагина в удобном для вас месте внутри папки вашего модуля. Нет строгих правил касательно структуры папок для плагинов, но рекомендуется поддерживать чистоту и порядок в структуре вашего проекта. Вы так же можете создать плагины для вашего проекта/приложения в целом.

3) Для того чтобы startupjs смог обнаружить ваш плагин, необходимо добавить его в package.json вашего модуля. Это делается путем добавления пути к файлу плагина в секцию exports. Если плагин пишется для всего проекта/приложения, то используем package.json из корня проекта.

4) Убедитесь, что путь к файлу плагина указан относительно корня вашего проекта. После этого, при запуске startupjs, система автоматически обработает ваш плагин в соответствии с предоставленными экспортами.

Давай посмотрим на примере.

Создадим файл customInputType.plugin.js.
Плагин будет иметь следующий вид:

```js
import { createPlugin } from 'startupjs/registry'

// плагин создается с помощью функции createPlugin
export default createPlugin({
  // name - уникальное название плагина
  name: 'custom-input-type',
  // enabled указывает, включен плагин или нет.
  // Если его значение false, то плагин считается отключенным и его
  // функциональность не будет активирована в приложении.
  enabled: true,
  // client, isomorphic, server - среда выполнения
  client: (pluginOptions) => ({
    // Здесь может быть добавлена реализация клиентских хуков. Например,
    // для наглядности добавим хук customFormInputs
    customFormInputs: () => ({
      // Код. Детальнее, как работают этот и другие хуки, мы рассмотрим позже
    })
  }),
  server: (pluginOptions) => ({
    // Здесь может быть добавлена реализация серверных хуков. Например,
    // для наглядности добавим хук api
    api: (expressApp) => {
      expressApp.get('/api/your-uniq-path', async (req, res) => {})
      expressApp.post('/api/your-uniq-path', async (req, res) => {})
    }
  }),
  isomorphic: (pluginOptions) => ({
    // Здесь может быть добавлена реализация изоморфных хуков
  }),
})
```

Добавим информацию об этом файле в раздел `exports` файла `package.json` в соответствии с его названием, например, `customInputType.plugin.js`, чтобы он автоматически загружался в ваше приложение. Если плагины лежат в отдельной папке, то необходимо учесть путь.

Вы можете подключать любое количество плагинов. Для этого просто перечислите их через запятую.

```json
"exports": {
  "./plugins/customInputType.plugin.js": "./plugins/customInputType.plugin.js",
  "./plugins/firstPlugin.plugin.js": "./plugins/firstPlugin.plugin.js",
  "./plugins/secondPlugin.plugin.js": "./plugins/secondPlugin.plugin.js"
}
```

Для того, чтобы передать параметры в плагин (pluginOptions в нашем примере), вам нужно указать их в файле startupjs.config.js, который находится в корневой папке вашего проекта. Для этого сначала импортируем плагины в этот файл, затем указываем параметры для каждого плагина в разделе plugins, где ключами являются имена плагинов, а значениями - объекты с параметрами для серверных, клиентских и изоморфных хуков:

```js
  // импортируем плагины из соответствующих файлов
  import customInputType from './plugins/customInputType.plugin.js'
  import firstPlugin from './plugins/firstPlugin.plugin.js'

  export default {
    plugins: {
      // Здесь customInputType, firstPlugin - названия плагинов, под которыми мы их импортировали
      // firstPlugin указан для примера, чтоб показать, как мы добавляем несколько плагинов в этот файл
      [customInputType]: {
        // Здесь указываем все, что касается серверных хуков
        server: {
          // Список параметров для серверных хуков. Они будут храниться в pluginOptions и доступны в хуках.
          someServerOption: 'some value'
        },
        // Здесь указываем все, что касается клиентских хуков
        client: {
          // Список параметров для клиентских хуков. Они будут храниться в pluginOptions и доступны в хуках.
          someClientOption: 'some value'
        },
        // Здесь указываем все, что касается изоморфных хуков
        isomorphic: {
          // Список параметров для изоморфных хуков. Они будут храниться в pluginOptions и доступны в хуках.
          someIsomorphicOption: 'some value'
        }
      },
      // через запятую прописываем остальные плагины. В нашем случае firstPlugin
      [firstPlugin]: {
        // Eсли параметры для client не нужны, то можно просто не указывать этот блок. Аналогично с server и isomorphic
        // Для этого плагина, например, нам нужно передать опции только для серверных хуков.
        server: {
          someOption: 'Hello from server!'
        }
      }
      // Здесь вы можете добавить свой плагин со списком необходимых параметров.
    }
  }
```

### Order (опционально)

Опционально в createPlugin Вы можете добавить order - порядок исполнения плагинов, указав "группу" исполнения.
Помимо указанных ниже "групп", вы так же можете использовать варианты 'before группа' и 'after группа'.

Возможные варианты групп в порядке их исполнения:

```js
  'first',
  'root',
  'session',
  'auth',
  'api',
  'pure', // для чистых плагинов startupjs, которые не зависят от наличия 'ui' или 'router'
  'ui', //  для плагинов, которые зависят от 'ui'
  'router', // для плагинов, которые зависят от 'router'
  'default', // группа по умолчанию, которая выполняется после всех остальных
  'last'
```

Например,

```js
export default createPlugin({
  name: 'my-plugin',
  order: 'ui',
  client: (pluginOptions) => ({
    // ...
  })
})
```

### For (опционально)

Свойство for указывает, для какого модуля создается этот плагин. Например, если вы создаете плагин для модуля admin, вы можете указать for: 'admin'. [Детальнее про модули можно почитать тут](https://github.com/startupjs/startupjs/blob/master/packages/startupjs/aboutModules.ru.md)

Например,

```js
export default createPlugin({
  name: 'my-plugin',
  for: 'admin',
  client: () => ({
    // ...
  })
})
```

Когда вы создаете плагин с указанием for: 'admin', StartupJS автоматически подключает этот плагин к модулю с именем "admin".
Если for не указан, то модулем по умолчанию станет непосредственно платформа startupjs.


## Читайте дальше:
- [Хуки для плагинов](https://github.com/startupjs/startupjs/blob/master/packages/startupjs/hooks.ru.md)
